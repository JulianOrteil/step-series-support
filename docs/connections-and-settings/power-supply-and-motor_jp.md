## 電源の接続
### 使用可能な電源
電源部はSTEP400とSTEP800で異なっています。
| 機種 | 電圧範囲（絶対定格）|
| --- | --- |
| STEP400 | 12V-76V |
| STEP800 | 9V-36V |

この電圧は直接モータドライバに供給されます。また基板上で5Vと3.3Vに降圧されて制御電源に使用しています。 USB端子にPCなどを接続した場合は制御電源のみ供給されます。必要な電源の定格は、使用するモータの種類や数、駆動電圧によって異なります。

### 電源端子
本デバイスにはDCジャック(4)と、ねじ式端子(5)の2種類の電源端子があります。
<img src="https://ponoor.com/cms/wp-content/uploads/2020/10/step400_connectors_numbering.jpg" width="600" />

| 番号 | 説明 |
| --- | --- |
| 1  | 電磁ブレーキ用コネクタ (STEP400) |
| 2  | Ethernet |
| 3  | USB type-C |
| 4  | DCジャック |
| 5  | 電源用ねじ式ターミナル |

DCジャックとねじ式ターミナルは、基板上で並列接続されています。**両方へ給電することは非常に危険ですので絶対に行わないでください。**

#### DCジャック
- 外径5.5mm
- 内径2.1mm
- センタープラス

のコネクタが適合します。DCジャックの定格は24V5Aです。それを超える電圧および電流で使用する場合は、ねじ式ターミナルを使用してください。

#### ねじ式ターミナル
基板端面から見て左がマイナス、右側がプラスの端子です。各端子のねじ径はM3です。直接ケーブルの芯線を締めこむこともできますが、専用の端子を使うとより確実に接続できます。
適合する端子の例としては以下のものがあります。

- ニチフ TMEX1.25-3N

## モータの接続
### モータの選定
本デバイスで使用可能なモータはバイポーラ型ステッピングモータです。相電流については以下の範囲が目安になります。

| 機種 | 相電流 |
| --- | --- |
| STEP400 | 5A以下 |
| STEP800 | 2A以下 |

いくつかのモータについて、実測した値から割り出したレジスタ値の例を、configツール用ファイルの形で公開しています。

https://ponoor.com/docs/step-series/settings/example-parameter-values-for-example-steppers/

### 接続端子
<img src="https://ponoor.com/cms/wp-content/uploads/2020/10/image-1604122105179.png" width="600" />

基板上は3.81mm（0.150インチ）ピッチのヘッダ（ユーロスタイル・ターミナルブロック）になっています。嵌合するコネクタには以下のものがあります。

- TE Connectivity AMP Connectors 284507-4
- Ningbo Kangnex Elec WJ15EDGK-3.81-4P

バイポーラ型ステッピングモータは、コイルが2つ組み込まれています。モータを接続するためには、モータから出ている4本の線がそれぞれのコイルがどの線に接続されているかを確認する必要があります。線色とコイルの組み合わせはモータのデータシートに掲載されています。またテスターがあれば、コイルはかなり抵抗値が低いため、同じコイルにつながっているかどうかを抵抗計で判定可能です。

2つのコイルから出てきた線を下記のように接続します。この配線はSTEP400/STEP800で共通のものです。

<img src="https://ponoor.com/cms/wp-content/uploads/2020/10/coil-wiring.png" width="600" />

この時、コイルA/Bがどちらのコイルになっても構いません。また一つのコイルの中での配線の順序もどちらでも大丈夫です。これらが入れかわってもモータの回転自体には何も問題ありませんが、回転方向が逆転します。実際に使う場合は基板全体で接続ルールが統一されていると便利です。

## 電源とステッピングモータの定格の関係
### モータのインダクタンス
ステッピングモータの内部の巻線は、インダクタンスとして振る舞います。インダクタンスに電圧をかけてもすぐには電流が流れずに、時間をかけて電流が立ち上がります。ステッピングモータのように、ステップごとにON/OFFを繰り返す場合は、回転数が上がってくるとON/OFFの周期が短くなり、十分に電流が流れなくなってきます。ステッピングモータのトルクは、電流にほぼ比例していますので、高速に回転すると最大トルクが低下します。

### 電源電圧
このインダクタンスに打ち勝ってモータに電流を流し込むには、できるだけ高い電圧の電源を使う必要があります。モータのデータシートを見ると、定格電圧として非常に低い数値が書かれていることがありますが、モータを回転させるとその電圧で必要な電流を流すことはできません。実際にはその何倍もの電圧が必要です。

下のグラフは、ST社のアプリケーションノートに記載されていた電圧と電流の関係の例です。モータによって実際の数値は異なりますが、低い電源電圧の場合は回転数が上がってくると電流が流せなくなってしまう様子が見て取れます。
<img src="https://ponoor.com/cms/wp-content/uploads/2020/10/motor_current_example_graph-800x570.png" width="800" />

実際に必要な電圧はモータの定格や必要な回転速さ、負荷によって大きく変わりますが、大雑把には

- NEMA17サイズまで：24V
- NEMA23サイズ以上：48V, 高回転の場合は72V

といった印象です。すなわちNEMA23サイズ以上の場合はSTEP800で駆動するのは難しいかもしれません。
とは言ってもモータによっては小さなサイズでも高トルクが出せたり、逆に大きなサイズでも電流があまり流せないものもありますので、定格を確認することが重要です。

STEP400についてはDC12Vでも動作しますが、DC-DCコンバータの動作電圧の下限に当たるため、モータを回した瞬間の突入電流によって電源装置からの配線で電圧降下が発生し、STEP400がリセットされてしまうことがあります。小型のモータを低トルクで回すような場合以外はおすすめしません。

<img src="https://ponoor.com/cms/wp-content/uploads/2020/10/update-48V-configuration-800x533.jpg" alt="STEP400 working with the 48 V configuration, series of two 24V power supplies." width="600" class="size-medium wp-image-949" /> 

この写真ではSTEP400に24Vの電源を2台直列に接続し、48Vで駆動しています。

### 電流容量
電源が供給できる電流も重要な要素です。脱調した瞬間に大きな電流が流れることがあり、電流容量に余裕がないと、電源側で保護機能が働いて電源が落ちてしまうことがあります。小型のモータを低速で回している場合は数アンペアの電流容量でも回せますが、大型モータを動かす場合や高速回転させる場合は10Aから20Aといった容量が必要なことが多いです。モータの個数や動かし方、電源装置側の保護回路の仕様などによって変化するため、できる限り余裕をもって選定してください。



